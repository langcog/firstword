---
title: "FW_cogsci"
output: html_document
This is the uniform data analysis for data for FW cogsci paper
---
Preliminaries.
```{r}
rm(list=ls())
library(ggplot2)
library(plyr)
library(reshape2)
library(dplyr)
library(stringr)
# library(arm)
library(knitr)
library(markdown)
library(directlabels)

theme_set(theme_bw())
```

Read data.

```{r}
df_turk=read.csv("../data/FW_TurkData.csv") #Turk data
df_cdm=read.csv("../data/CDMlangsurvey_analysis.csv") #CDM data
```

```{r}
df_turk$birth <- factor(df_turk$birth_order)
df_turk$age.grp <- cut(df_turk$age,breaks=c(5,10,14,18,24))
df_turk$currage.grp <- cut(df_turk$age_current, breaks=c(-1,2,4,6,8,10,12,14,16,18))
df_turk$agesplit <- cut(df_turk$age, breaks=c(0,12,24))
df_cdm$agesplit <- cut(df_cdm$age, breaks=c(0,12,24))
```

bind together.

```{r}
df_turk$dataset <- "MTurk"
df_cdm$dataset <- "CDM"

d <- rbind.fill(df_turk,df_cdm)
```

Do analysis over all data for CDI-cats.

```{r}
freqs <- d %>% 
  filter(!is.na(agesplit), cdi_cat != "N/A") %>%
  group_by(dataset, agesplit, cdi_cat) %>%
  summarise(n = n()) %>%
  group_by(dataset, agesplit, add=FALSE) %>%
  mutate(prop = n / sum(n))
```

Plot.

```{r}
quartz()
freqs$cdi_cat <- factor(freqs$cdi_cat, 
                                  levels=unique(with(freqs, cdi_cat
                                  [order(freqs$prop, cdi_cat, 
                                  decreasing = TRUE)])))

qplot(cdi_cat, prop, fill=agesplit, geom="bar", stat="identity", position="dodge", data=subset(freqs, agesplit != "NA" & cdi_cat != "N/A"))+ylab("Proportion of Total")+xlab("MB-CDI Category") + theme(axis.text.x=element_text(angle=90, hjust=1, vjust=.5)) + facet_wrap(~dataset)

```

Age data - set that up. 
```{r}
ns <- d %>% 
  filter(!is.na(age), age != "NA") %>%
  group_by(dataset, age) %>%
  summarise(n = n())
freqs <- ns %>% mutate(cum.n = cumsum(n)) %>%
  group_by(dataset) %>%
  mutate(prop = cum.n / sum(n))
```
```

Plot.
```{r}
quartz()
ggplot(data = freqs, aes(x = age, y = prop, colour=dataset))+geom_smooth(se=FALSE, data=freqs, aes(x=age, y=prop, colour=dataset))
```

CDI CATS WITH AGE SPLIT at 12m

First - Turk data

```{r}
quartz()
freqs <- ddply(df_turk, .(cdi_cat, first_wd_standard, agesplit), summarise, 
               count=length(first_wd_standard)) 

#Normalizing within the age split
freqs <- freqs %>%
group_by(agesplit) %>%
mutate(prop = count/sum(count)) 
#sorting so that the graph looks cool
freqs$cdi_cat <- factor(freqs$cdi_cat, 
                                  levels=unique(with(freqs, cdi_cat
                                  [order(freqs$prop, cdi_cat, 
                                  decreasing = TRUE)])))
#plot of the proportion within the age split with CDI_cat as first word, faceted by the age split - note, N/A categories are excluded
qplot(cdi_cat, prop, geom="bar", position="dodge", stat="identity",
           data=subset(freqs, count>1 & first_wd_standard != "N/A" & cdi_cat != "N/A" & agesplit != "NA")) + 
  theme(axis.text.x=element_text(angle=90, hjust=1, vjust=.5))+
  ylab("Proportion of Children with Utterance") + xlab("CDI Categories")+facet_wrap(~agesplit)
```

Second - CDM data 

```{r}
quartz()
freqs <- ddply(df_cdm, .(CDI_cat, Word_standard, agesplit), summarise, 
               count=length(Word_standard))
#normalizing
freqs <- freqs %>%
group_by(agesplit) %>%
mutate(prop = count/sum(count)) 
#sorting
freqs$CDI_cat <- factor(freqs$CDI_cat, 
                                  levels=unique(with(freqs, CDI_cat
                                  [order(freqs$prop, CDI_cat, 
                                  decreasing = TRUE)])))

qplot(CDI_cat, prop, geom="bar", position="dodge", stat="identity",
           data=subset(freqs, count>1 & Word_standard != "N/A" & CDI_cat != "N/A" & agesplit != "NA")) + 
  theme(axis.text.x=element_text(angle=90, hjust=1, vjust=.5))+
  ylab("Proportion of Children with Utterance") + xlab("CDI Categories")+facet_wrap(~agesplit)
```