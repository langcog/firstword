---
title: "FW_cogsci"
output: html_document
This is the uniform data analysis for data for FW cogsci paper
---
Preliminaries.
```{r}
rm(list=ls())
library(ggplot2)
library(plyr)
library(reshape2)
library(dplyr)
library(stringr)
# library(arm)
library(knitr)
library(markdown)
library(directlabels)

theme_set(theme_bw())
```

Read data.

```{r}
df_turk=read.csv("../data/FW_TurkData.csv") #Turk data
df_cdm=read.csv("../data/CDMlangsurvey_analysis.csv") #CDM data
df_info=read.csv("../data/FW_childesinfo.csv") #Childesinfo data
```

```{r}
df_turk$birth <- factor(df_turk$birth_order)
df_turk$age.grp <- cut(df_turk$age,breaks=c(5,10,14,18,24))
df_turk$currage.grp <- cut(df_turk$age_current, breaks=c(-1,2,4,6,8,10,12,14,16,18))
df_turk$agesplit <- cut(df_turk$age, breaks=c(0,12,24))
df_cdm$agesplit <- cut(df_cdm$age, breaks=c(0,12,24))
df_info$agesplit <- cut(df_info$age, breaks=c(0,12,24))
```

bind together.

```{r}
df_turk$dataset <- "MTurk"
df_cdm$dataset <- "CDM"
df_info$dataset <- "Info"

d <- rbind.fill(df_turk,df_cdm, df_info)
```

Do analysis over all data for CDI-cats.

```{r}
freqs <- d %>% 
  filter(!is.na(agesplit), cdi_cat != "N/A") %>%
  group_by(dataset, agesplit, cdi_cat) %>%
  summarise(n = n()) %>%
  group_by(dataset, agesplit, add=FALSE) %>%
  mutate(prop = n / sum(n))
```

Plot.

```{r}
quartz()
freqs$cdi_cat <- factor(freqs$cdi_cat, 
                                  levels=unique(with(freqs, cdi_cat
                                  [order(freqs$prop, cdi_cat, 
                                  decreasing = FALSE)])))


ggplot(data = freqs, aes(x=prop, y=cdi_cat, colour=dataset, group=dataset)) + geom_point()+ylab("MB-CDI category")+xlab("Proportion of Total") +
  scale_color_discrete(name="Dataset")

```

Age data - set that up. 
```{r}
ns <- d %>% 
  filter(!is.na(age), age != "NA") %>%
  mutate(dataset = factor(dataset)) %>%
  group_by(dataset, age) %>%
  summarise(n = n())

freqs.grid <- expand.grid(dataset=unique(ns$dataset),age=unique(ns$age)) %>%
  arrange(dataset,age)

freqs <- left_join(freqs.grid,ns) %>%
<<<<<<< HEAD
  filter(dataset == "MTurk" | dataset == "CDM" | dataset == "Info" & age >=10) %>%
=======
  filter(dataset == "MTurk" | dataset == "CDM" & age >=10) %>%
>>>>>>> ecab2e356b2a5f448f94ce845526c8160eee9f8e
  group_by() %>%
  mutate(n = ifelse(is.na(n), 0, n)) %>%
  group_by(dataset) %>%
  mutate(cum.n = cumsum(n),
         prop = cum.n / sum(n))
<<<<<<< HEAD

=======
>>>>>>> ecab2e356b2a5f448f94ce845526c8160eee9f8e
```

Plot.
```{r}
quartz()
ggplot(data = freqs, aes(x = age, y = prop, colour=dataset, group=dataset))+
  geom_smooth(se=FALSE,method = "loess") +ylab("Proportion of Total")+xlab("Age ") + scale_color_discrete(name="Dataset")
```

Plot.
```{r}
quartz()
ggplot(data = freqs, aes(x = age, y = prop, colour=dataset, group=dataset))+
  geom_smooth(se=FALSE,method = "loess")

CDI CATS WITH AGE SPLIT at 12m

First - Turk data

```{r}
quartz()
freqs <- ddply(df_turk, .(cdi_cat, first_wd_standard, agesplit), summarise, 
               count=length(first_wd_standard)) 

#Normalizing within the age split
freqs <- freqs %>%
group_by(agesplit) %>%
mutate(prop = count/sum(count)) 
#sorting so that the graph looks cool
freqs$cdi_cat <- factor(freqs$cdi_cat, 
                                  levels=unique(with(freqs, cdi_cat
                                  [order(freqs$prop, cdi_cat, 
                                  decreasing = TRUE)])))
#plot of the proportion within the age split with CDI_cat as first word, faceted by the age split - note, N/A categories are excluded
qplot(cdi_cat, prop, geom="bar", position="dodge", stat="identity",
           data=subset(freqs, count>1 & first_wd_standard != "N/A" & cdi_cat != "N/A" & agesplit != "NA")) + 
  theme(axis.text.x=element_text(angle=90, hjust=1, vjust=.5))+
  ylab("Proportion of Children with Utterance") + xlab("CDI Categories")+facet_wrap(~agesplit)
```

Second - CDM data 

```{r}
quartz()
freqs <- ddply(df_cdm, .(CDI_cat, Word_standard, agesplit), summarise, 
               count=length(Word_standard))
#normalizing
freqs <- freqs %>%
group_by(agesplit) %>%
mutate(prop = count/sum(count)) 
#sorting
freqs$CDI_cat <- factor(freqs$CDI_cat, 
                                  levels=unique(with(freqs, CDI_cat
                                  [order(freqs$prop, CDI_cat, 
                                  decreasing = TRUE)])))

qplot(CDI_cat, prop, geom="bar", position="dodge", stat="identity",
           data=subset(freqs, count>1 & Word_standard != "N/A" & CDI_cat != "N/A" & agesplit != "NA")) + 
  theme(axis.text.x=element_text(angle=90, hjust=1, vjust=.5))+
  ylab("Proportion of Children with Utterance") + xlab("CDI Categories")+facet_wrap(~agesplit)
```